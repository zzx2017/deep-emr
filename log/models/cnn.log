MODEL

nb_words = 36664
max_length = 5
embedding_dim = 20
dropout_prob = [0.2, 0.2]
filter_sizes = [2, 3, 4]

input_shape = (max_length,)
model_input = Input(shape=input_shape)

embedding_layer = Embedding(nb_words, embedding_dim, input_length=max_length, name="embedding", weights=[embedding_weights])(model_input)
embedding_layer = Dropout(dropout_prob[0])(embedding_layer)

convs = []
for filter_size in filter_sizes:
    conv = Convolution1D(filters=32, kernel_size=filter_size, padding="valid", activation="relu", strides=1)(embedding_layer)
    conv = MaxPooling1D(pool_size=2)(conv)
    conv = Flatten()(conv)
    convs.append(conv)

merge = Concatenate()(convs)
merge = Dropout(dropout_prob[1])(merge)
dense = Dense(256, activation="relu")(merge)

model_output = Dense(encoded_y.shape[1], activation="softmax")(dense)
model = Model(model_input, model_output)

optimiser = Nadam(lr=0.002, beta_1=0.9, beta_2=0.999, epsilon=1e-08, schedule_decay=0.004)
model.compile(loss="categorical_crossentropy", optimizer=optimiser, metrics=["accuracy"])

early_stopping_monitor = EarlyStopping(monitor='loss', patience=2)
model.fit(x_train, encoded_y, epochs=10, batch_size=32, callbacks=[early_stopping_monitor], verbose=2)

				OVERALL
---------------------------------------------------------------------------
 (514)                   Measure        Macro (SD)     Micro (Primary)     
---------------------------------------------------------------------------
Total                    Precision      0.8451 (0.14)  0.8571              
                         Recall         0.8956 (0.12)  0.8949              
                         F1             0.8696         0.8756              


				CAD
---------------------------------------------------------------------------
 (514)                   Measure        Macro (SD)     Micro (Primary)     
---------------------------------------------------------------------------
Total                    Precision      0.3292 (0.42)  0.5863              
                         Recall         0.3764 (0.47)  0.8839              
                         F1             0.3512         0.705               


				DIABETES
---------------------------------------------------------------------------
 (514)                   Measure        Macro (SD)     Micro (Primary)     
---------------------------------------------------------------------------
Total                    Precision      0.6625 (0.46)  0.928               
                         Recall         0.6493 (0.46)  0.9169              
                         F1             0.6558         0.9224              


				OBESE
---------------------------------------------------------------------------
 (514)                   Measure        Macro (SD)     Micro (Primary)     
---------------------------------------------------------------------------
Total                    Precision      0.1543 (0.36)  0.8403              
                         Recall         0.1586 (0.36)  0.9237              
                         F1             0.1564         0.88                


				HYPERLIPIDEMIA
---------------------------------------------------------------------------
 (514)                   Measure        Macro (SD)     Micro (Primary)     
---------------------------------------------------------------------------
Total                    Precision      0.4105 (0.49)  0.9477              
                         Recall         0.4028 (0.48)  0.8442              
                         F1             0.4066         0.893               


				HYPERTENSION
---------------------------------------------------------------------------
 (514)                   Measure        Macro (SD)     Micro (Primary)     
---------------------------------------------------------------------------
Total                    Precision      0.6925 (0.42)  0.8644              
                         Recall         0.7141 (0.43)  0.9319              
                         F1             0.7032         0.8969              


				MEDICATION
---------------------------------------------------------------------------
 (514)                   Measure        Macro (SD)     Micro (Primary)     
---------------------------------------------------------------------------
Total                    Precision      0.7591 (0.35)  0.8859              
                         Recall         0.7772 (0.34)  0.8895              
                         F1             0.768          0.8877              


				SMOKER
---------------------------------------------------------------------------
 (514)                   Measure        Macro (SD)     Micro (Primary)     
---------------------------------------------------------------------------
Total                    Precision      0.8058 (0.38)  0.7868              
                         Recall         0.8327 (0.37)  0.8359              
                         F1             0.819          0.8106              


				FAMILY_HIST
---------------------------------------------------------------------------
 (514)                   Measure        Macro (SD)     Micro (Primary)     
---------------------------------------------------------------------------
Total                    Precision      0.9455 (0.23)  0.9455              
                         Recall         0.9455 (0.23)  0.9455              
                         F1             0.9455         0.9455              


				CAD.mention
---------------------------------------------------------------------------
 (514)                   Measure        Macro (SD)     Micro (Primary)     
---------------------------------------------------------------------------
Total                    Precision      0.3249 (0.47)  0.8107              
                         Recall         0.3307 (0.47)  0.9709              
                         F1             0.3278         0.8836              


				CAD.event
---------------------------------------------------------------------------
 (514)                   Measure        Macro (SD)     Micro (Primary)     
---------------------------------------------------------------------------
Total                    Precision      0.2315 (0.42)  0.4938              
                         Recall         0.2296 (0.42)  0.8561              
                         F1             0.2305         0.6263              


				CAD.test
---------------------------------------------------------------------------
 (514)                   Measure        Macro (SD)     Micro (Primary)     
---------------------------------------------------------------------------
Total                    Precision      0.1012 (0.3)   0.2008              
                         Recall         0.09728 (0.29) 0.8814              
                         F1             0.09918        0.327               


				CAD.symptom
---------------------------------------------------------------------------
 (514)                   Measure        Macro (SD)     Micro (Primary)     
---------------------------------------------------------------------------
Total                    Precision      0.04086 (0.2)  0.3281              
                         Recall         0.0347 (0.18)  0.3                 
                         F1             0.03752        0.3134              


				DIABETES.mention
---------------------------------------------------------------------------
 (514)                   Measure        Macro (SD)     Micro (Primary)     
---------------------------------------------------------------------------
Total                    Precision      0.6693 (0.47)  0.9477              
                         Recall         0.6712 (0.47)  0.969               
                         F1             0.6702         0.9582              


				DIABETES.a1c
---------------------------------------------------------------------------
 (514)                   Measure        Macro (SD)     Micro (Primary)     
---------------------------------------------------------------------------
Total                    Precision      0.09728 (0.3)  0.6667              
                         Recall         0.09339 (0.29) 0.6098              
                         F1             0.09529        0.6369              


				DIABETES.glucose
---------------------------------------------------------------------------
 (514)                   Measure        Macro (SD)     Micro (Primary)     
---------------------------------------------------------------------------
Total                    Precision      0.0 (0.0)      0.0                 
                         Recall         0.0 (0.0)      0.0                 
                         F1             nan            0.0                 


				OBESE.mention
---------------------------------------------------------------------------
 (514)                   Measure        Macro (SD)     Micro (Primary)     
---------------------------------------------------------------------------
Total                    Precision      0.1543 (0.36)  0.844               
                         Recall         0.1634 (0.37)  0.9714              
                         F1             0.1588         0.9032              


				OBESE.bmi
---------------------------------------------------------------------------
 (514)                   Measure        Macro (SD)     Micro (Primary)     
---------------------------------------------------------------------------
Total                    Precision      0.007782 (0.088)0.6667              
                         Recall         0.007782 (0.088)0.2353              
                         F1             0.007782       0.3478              


				HYPERLIPIDEMIA.mention
---------------------------------------------------------------------------
 (514)                   Measure        Macro (SD)     Micro (Primary)     
---------------------------------------------------------------------------
Total                    Precision      0.4047 (0.49)  0.963               
                         Recall         0.4047 (0.49)  0.8776              
                         F1             0.4047         0.9183              


				HYPERLIPIDEMIA.high_ldl
---------------------------------------------------------------------------
 (514)                   Measure        Macro (SD)     Micro (Primary)     
---------------------------------------------------------------------------
Total                    Precision      0.01946 (0.14) 0.4762              
                         Recall         0.01946 (0.14) 0.3448              
                         F1             0.01946        0.4                 


				HYPERLIPIDEMIA.high_chol
---------------------------------------------------------------------------
 (514)                   Measure        Macro (SD)     Micro (Primary)     
---------------------------------------------------------------------------
Total                    Precision      0.0 (0.0)      0.0                 
                         Recall         0.0 (0.0)      0.0                 
                         F1             nan            0.0                 


				HYPERTENSION.mention
---------------------------------------------------------------------------
 (514)                   Measure        Macro (SD)     Micro (Primary)     
---------------------------------------------------------------------------
Total                    Precision      0.7004 (0.46)  0.9574              
                         Recall         0.7043 (0.46)  0.9836              
                         F1             0.7023         0.9704              


				HYPERTENSION.high_bp
---------------------------------------------------------------------------
 (514)                   Measure        Macro (SD)     Micro (Primary)     
---------------------------------------------------------------------------
Total                    Precision      0.2412 (0.43)  0.4699              
                         Recall         0.2344 (0.42)  0.641               
                         F1             0.2378         0.5423              


				MEDICATION.ace_inhibitor
---------------------------------------------------------------------------
 (514)                   Measure        Macro (SD)     Micro (Primary)     
---------------------------------------------------------------------------
Total                    Precision      0.3554 (0.47)  0.8824              
                         Recall         0.3735 (0.48)  0.8911              
                         F1             0.3642         0.8867              


				MEDICATION.anti_diabetes
---------------------------------------------------------------------------
 (514)                   Measure        Macro (SD)     Micro (Primary)     
---------------------------------------------------------------------------
Total                    Precision      0.0 (0.0)      0.0                 
                         Recall         0.0 (0.0)      0.0                 
                         F1             nan            0.0                 


				MEDICATION.arb
---------------------------------------------------------------------------
 (514)                   Measure        Macro (SD)     Micro (Primary)     
---------------------------------------------------------------------------
Total                    Precision      0.07328 (0.26) 0.9658              
                         Recall         0.07588 (0.26) 0.5855              
                         F1             0.07456        0.729               


				MEDICATION.aspirin
---------------------------------------------------------------------------
 (514)                   Measure        Macro (SD)     Micro (Primary)     
---------------------------------------------------------------------------
Total                    Precision      0.4922 (0.49)  0.9234              
                         Recall         0.5214 (0.5)   0.9511              
                         F1             0.5064         0.937               


				MEDICATION.beta_blocker
---------------------------------------------------------------------------
 (514)                   Measure        Macro (SD)     Micro (Primary)     
---------------------------------------------------------------------------
Total                    Precision      0.5214 (0.49)  0.8933              
                         Recall         0.5564 (0.5)   0.9629              
                         F1             0.5383         0.9268              


				MEDICATION.calcium_channel_blocker
---------------------------------------------------------------------------
 (514)                   Measure        Macro (SD)     Micro (Primary)     
---------------------------------------------------------------------------
Total                    Precision      0.2374 (0.42)  0.8971              
                         Recall         0.2549 (0.44)  0.9506              
                         F1             0.2458         0.9231              


				MEDICATION.diuretic
---------------------------------------------------------------------------
 (514)                   Measure        Macro (SD)     Micro (Primary)     
---------------------------------------------------------------------------
Total                    Precision      0.1174 (0.31)  0.7637              
                         Recall         0.1299 (0.33)  0.7126              
                         F1             0.1233         0.7373              


				MEDICATION.dpp4_inhibitors
---------------------------------------------------------------------------
 (514)                   Measure        Macro (SD)     Micro (Primary)     
---------------------------------------------------------------------------
Total                    Precision      0.0 (0.0)      0.0                 
                         Recall         0.0 (0.0)      0.0                 
                         F1             nan            0.0                 


				MEDICATION.ezetimibe
---------------------------------------------------------------------------
 (514)                   Measure        Macro (SD)     Micro (Primary)     
---------------------------------------------------------------------------
Total                    Precision      0.009728 (0.098)1.0                 
                         Recall         0.009728 (0.098)0.4167              
                         F1             0.009728       0.5882              


				MEDICATION.fibrate
---------------------------------------------------------------------------
 (514)                   Measure        Macro (SD)     Micro (Primary)     
---------------------------------------------------------------------------
Total                    Precision      0.0214 (0.14)  0.7333              
                         Recall         0.0214 (0.14)  0.3667              
                         F1             0.0214         0.4889              


				MEDICATION.insulin
---------------------------------------------------------------------------
 (514)                   Measure        Macro (SD)     Micro (Primary)     
---------------------------------------------------------------------------
Total                    Precision      0.2458 (0.42)  0.8479              
                         Recall         0.2588 (0.44)  0.9595              
                         F1             0.2521         0.9002              


				MEDICATION.metformin
---------------------------------------------------------------------------
 (514)                   Measure        Macro (SD)     Micro (Primary)     
---------------------------------------------------------------------------
Total                    Precision      0.2205 (0.4)   0.8651              
                         Recall         0.2442 (0.43)  0.9164              
                         F1             0.2317         0.8901              


				MEDICATION.niacin
---------------------------------------------------------------------------
 (514)                   Measure        Macro (SD)     Micro (Primary)     
---------------------------------------------------------------------------
Total                    Precision      0.0 (0.0)      0.0                 
                         Recall         0.0 (0.0)      0.0                 
                         F1             nan            0.0                 


				MEDICATION.nitrate
---------------------------------------------------------------------------
 (514)                   Measure        Macro (SD)     Micro (Primary)     
---------------------------------------------------------------------------
Total                    Precision      0.1154 (0.31)  0.7706              
                         Recall         0.1304 (0.34)  0.6568              
                         F1             0.1224         0.7092              


				MEDICATION.statin
---------------------------------------------------------------------------
 (514)                   Measure        Macro (SD)     Micro (Primary)     
---------------------------------------------------------------------------
Total                    Precision      0.5019 (0.49)  0.9314              
                         Recall         0.5214 (0.5)   0.9474              
                         F1             0.5115         0.9393              


				MEDICATION.sulfonylureas
---------------------------------------------------------------------------
 (514)                   Measure        Macro (SD)     Micro (Primary)     
---------------------------------------------------------------------------
Total                    Precision      0.1492 (0.35)  0.8812              
                         Recall         0.1556 (0.36)  0.7986              
                         F1             0.1523         0.8379              


				MEDICATION.thiazolidinedione
---------------------------------------------------------------------------
 (514)                   Measure        Macro (SD)     Micro (Primary)     
---------------------------------------------------------------------------
Total                    Precision      0.03372 (0.18) 0.8254              
                         Recall         0.03891 (0.19) 0.8525              
                         F1             0.03613        0.8387              


				MEDICATION.thienopyridine
---------------------------------------------------------------------------
 (514)                   Measure        Macro (SD)     Micro (Primary)     
---------------------------------------------------------------------------
Total                    Precision      0.1783 (0.38)  0.8987              
                         Recall         0.1926 (0.39)  0.9683              
                         F1             0.1852         0.9322              


				SMOKER.current
---------------------------------------------------------------------------
 (514)                   Measure        Macro (SD)     Micro (Primary)     
---------------------------------------------------------------------------
Total                    Precision      0.0214 (0.14)  0.55                
                         Recall         0.0214 (0.14)  0.3333              
                         F1             0.0214         0.4151              


				SMOKER.past
---------------------------------------------------------------------------
 (514)                   Measure        Macro (SD)     Micro (Primary)     
---------------------------------------------------------------------------
Total                    Precision      0.2004 (0.4)   0.6913              
                         Recall         0.2004 (0.4)   0.9115              
                         F1             0.2004         0.7863              


				SMOKER.ever
---------------------------------------------------------------------------
 (514)                   Measure        Macro (SD)     Micro (Primary)     
---------------------------------------------------------------------------
Total                    Precision      0.0 (0.0)      0.0                 
                         Recall         0.0 (0.0)      0.0                 
                         F1             nan            0.0                 


				SMOKER.never
---------------------------------------------------------------------------
 (514)                   Measure        Macro (SD)     Micro (Primary)     
---------------------------------------------------------------------------
Total                    Precision      0.1615 (0.37)  0.883               
                         Recall         0.1615 (0.37)  0.6917              
                         F1             0.1615         0.7757              


				SMOKER.unknown
---------------------------------------------------------------------------
 (514)                   Measure        Macro (SD)     Micro (Primary)     
---------------------------------------------------------------------------
Total                    Precision      0.4494 (0.5)   0.8221              
                         Recall         0.4494 (0.5)   0.9506              
                         F1             0.4494         0.8817              


				FAMILY_HIST.present
---------------------------------------------------------------------------
 (514)                   Measure        Macro (SD)     Micro (Primary)     
---------------------------------------------------------------------------
Total                    Precision      0.007782 (0.088)0.2353              
                         Recall         0.007782 (0.088)0.2105              
                         F1             0.007782       0.2222              


				FAMILY_HIST.not_present
---------------------------------------------------------------------------
 (514)                   Measure        Macro (SD)     Micro (Primary)     
---------------------------------------------------------------------------
Total                    Precision      0.9377 (0.24)  0.9698              
                         Recall         0.9377 (0.24)  0.9737              
                         F1             0.9377         0.9718              
